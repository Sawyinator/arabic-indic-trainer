<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-INT | Arabic-Indic Number Trainer</title>
    <style>
        :root {
            --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; --primary: #3f51b5;
            --accent: #ff9800; --secondary: #424242; --input-bg: #2d2d2d; --danger: #f44336;
            --success: #4caf50; --warning: #ffeb3b; --overlay: rgba(0,0,0,0.8);
            --grey-btn: #555555;
        }
        .light-mode {
            --bg: #f4f4f9; --card: #ffffff; --text: #333333; --primary: #007bff;
            --accent: #f57c00; --secondary: #e0e0e0; --input-bg: #ffffff; --danger: #d32f2f;
            --success: #2e7d32; --warning: #fbc02d; --overlay: rgba(0,0,0,0.4);
            --grey-btn: #cccccc;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex; align-items: center; justify-content: center;
            height: 100vh; margin: 0; background-color: var(--bg); color: var(--text);
            transition: background 0.3s; overflow: hidden;
        }
        .container {
            text-align: center; background: var(--card); padding: 2rem;
            border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 95%; max-width: 600px; position: relative;
            overflow: hidden;
        }
        .hidden { display: none !important; }
        #theme-toggle { position: absolute; top: 15px; right: 15px; cursor: pointer; font-size: 1.5rem; user-select: none; z-index: 20; }
        
        /* VIEW TRANSITIONS */
        .view-section { animation: slideFadeIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; }
        @keyframes slideFadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* MODAL STYLES */
        #modal-overlay, #profile-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--overlay); display: flex; align-items: center;
            justify-content: center; z-index: 1000; backdrop-filter: blur(4px);
            opacity: 0; pointer-events: none; transition: opacity 0.2s ease;
        }
        #modal-overlay.active, #profile-overlay.active { opacity: 1; pointer-events: auto; }
        .modal {
            background: var(--card); padding: 2rem; border-radius: 16px;
            max-width: 400px; width: 85%; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border: 1px solid #444; text-align: center;
            transform: scale(0.85); transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        #modal-overlay.active .modal, #profile-overlay.active .modal { transform: scale(1); }

        /* PROFILE STYLES */
        .profile-pic { 
            width: 90px; height: 90px; border-radius: 50%; 
            background: var(--secondary); margin: 0 auto 15px; 
            display: flex; align-items: center; justify-content: center; 
            border: 3px solid var(--secondary);
            overflow: hidden;
        }
        .profile-pic img { 
            width: 100%; height: 100%; 
            object-fit: cover;
            display: block;
        }

        .profile-links { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .profile-link { 
            background: var(--input-bg); color: var(--text); padding: 12px; 
            border-radius: 8px; text-decoration: none; font-weight: 600; 
            border: 1px solid #444; transition: 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .profile-link svg { width: 20px; height: 20px; fill: currentColor; }
        .profile-link:hover { background: var(--secondary); border-color: var(--primary); transform: translateY(-2px); }

        h1 { margin-bottom: 0; }
        .credit { font-size: 0.75rem; color: #777; margin-top: 4px; margin-bottom: 20px; font-weight: normal; letter-spacing: 0.5px; }
        .credit span { cursor: pointer; transition: color 0.2s; text-decoration: none; }
        .credit span:hover { color: var(--primary); text-decoration: underline; }
        
        /* TABLE STYLES */
        .table-wrapper { max-height: 380px; overflow-y: auto; border-radius: 10px; background: rgba(0,0,0,0.2); border: 1px solid #333; margin-top: 10px; }
        .score-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .score-table th { position: sticky; top: 0; background: #333; padding: 12px 8px; color: #aaa; text-transform: uppercase; font-size: 0.7rem; letter-spacing: 1px; z-index: 10; }
        .score-table td { padding: 10px 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .score-table tr:nth-child(even) { background: rgba(255,255,255,0.02); }
        .col-len { font-weight: bold; color: #ffffff !important; background: rgba(0,0,0,0.3); width: 80px; }
        .val-1s { color: #ff5252; font-weight: bold; }
        .val-5s { color: #ffab40; font-weight: bold; }
        .val-10s { color: #448aff; font-weight: bold; }
        .val-20s { color: #69f0ae; font-weight: bold; }
        .empty-score { opacity: 0.2; font-weight: normal; }

        #arabic-display { font-size: 4rem; margin-bottom: 0.5rem; min-height: 1.2em; word-wrap: break-word; font-weight: 500; }
        
        /* TIME BUTTON SYSTEM */
        .time-row { display: flex; gap: 5px; margin: 10px 0 20px 0; justify-content: center; }
        .time-btn { 
            flex: 1; padding: 10px; font-size: 0.9rem; 
            background: var(--grey-btn); color: white; 
            border-radius: 6px; border: none; cursor: pointer; 
            font-weight: bold; transition: background 0.2s, filter 0.2s;
        }
        .time-btn:hover { filter: brightness(1.2); }
        .time-btn.active { background: var(--primary); color: white; cursor: default; filter: none; }
        
        .controls { background: var(--input-bg); padding: 15px; border-radius: 10px; margin-bottom: 1.5rem; }
        .digit-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 15px; }
        .digit-item { display: flex; flex-direction: column; align-items: center; background: var(--secondary); padding: 10px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .digit-item:hover { background: #444; }
        .digit-item input { cursor: pointer; margin-top: 5px; transform: scale(1.2); }
        input[type=range] { width: 100%; height: 25px; cursor: pointer; }
        input[type=text] { background: var(--input-bg); border: 2px solid #444; color: var(--text); padding: 12px; border-radius: 8px; font-size: 1.5rem; text-align: center; width: 80%; margin-bottom: 1rem; outline: none; transition: border-color 0.2s; }
        .shake { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; border-color: var(--danger) !important; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        #timer-bar-container { width: 100%; height: 10px; background: #333; margin-bottom: 1.5rem; border-radius: 5px; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: var(--success); transition: width 0.1s linear, background-color 0.3s ease; }
        .btn-group { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        button { padding: 12px 24px; font-size: 1rem; font-weight: 600; cursor: pointer; border: none; border-radius: 8px; transition: 0.2s; }
        .primary-btn { background-color: var(--primary); color: white; flex-grow: 1; }
        .primary-btn:disabled { background-color: #333 !important; color: #666 !important; cursor: not-allowed; }
        .secondary-btn { background-color: var(--secondary); color: var(--text); }
        .danger-btn { background-color: var(--danger); color: white; }
        .menu-btn { background-color: var(--primary); color: white; width: 100%; margin-bottom: 10px; font-size: 1.1rem; padding: 15px; }
        .menu-btn:disabled { background-color: #444; color: #777; cursor: not-allowed; }
        .settings-btn { background-color: var(--grey-btn); color: white; width: 100%; margin-top: 10px; font-size: 1.1rem; padding: 15px; border-radius: 8px; }
        .settings-btn:hover { filter: brightness(1.2); }
        #feedback { font-weight: bold; margin-bottom: 0.5rem; height: 1.2em; font-size: 1.2rem; }
        #quiz-stats-display { font-size: 0.9rem; color: #888; margin-bottom: 1rem; }
        .correct { color: var(--success); }
        .incorrect { color: var(--danger); }
        .highlight-menu { border: 2px solid var(--primary) !important; box-shadow: 0 0 15px var(--primary); }
    </style>
</head>
<body>

<div id="theme-toggle" onclick="toggleTheme()">ðŸŒ™</div>

<div id="modal-overlay">
    <div class="modal">
        <h3 id="modal-title">Confirmation</h3>
        <p id="modal-text">Are you sure you want to proceed?</p>
        <div style="display:flex; gap:10px;">
            <button class="secondary-btn" style="flex:1" onclick="closeModal()">Back</button>
            <button id="modal-confirm-btn" class="danger-btn" style="flex:1">Confirm</button>
        </div>
    </div>
</div>

<div id="profile-overlay" onclick="closeProfile(event)">
    <div class="modal" onclick="event.stopPropagation()">
        <div class="profile-pic" id="profile-img-container">
            <img src="https://github.com/Sawyinator.png" alt="Sawyinator" onerror="this.parentElement.style.display='none';">
        </div>
        
        <h2 style="margin-bottom:5px;">Sawyinator</h2>
        <p style="margin-top:0; font-size:0.9rem; color:#888;">silly guy</p>
        <p style="font-size:0.9rem; margin-bottom:20px; line-height: 1.4;">
            I built A-INT to practice arabic-indic numbers and though it would be a useful thing to make public. hope you enjoy foo.
        </p>
        
        <div class="profile-links">
            <a href="https://github.com/Sawyinator" target="_blank" class="profile-link">
                <svg viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.041-1.416-4.041-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                GitHub
            </a>
            <a href="https://github.com/Sawyinator/A-INT" target="_blank" class="profile-link">
                <svg viewBox="0 0 24 24"><path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.833z"/></svg>
                A-INT Repository
            </a>
            <a href="https://youtube.com/@sawyinator" target="_blank" class="profile-link">
                <svg viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>
                My YouTube
            </a>
        </div>
        
        <button class="secondary-btn" style="width:100%; margin-top:20px;" onclick="closeProfile()">Close</button>
    </div>
</div>

<div class="container">
    <div id="main-menu" class="view-section">
        <h1>Arabic-Indic Number Trainer</h1>
        <div class="credit">By <span onclick="openProfile()">Sawyinator</span></div>
        <div class="controls">
            <label id="menu-length-label">Digit Length: 4</label><br>
            <input type="range" id="menu-slider" min="1" max="16" value="4" oninput="syncLabels(this.value)" onchange="syncSliders(this.value)">
        </div>
        <button class="menu-btn" onclick="startMode('generator')">Free Practice</button>
        <button id="quiz-start-btn" class="menu-btn" onclick="startMode('quiz')">Quiz Mode (10s)</button>
        <div class="time-row">
            <button class="time-btn" data-time="1" onclick="setTimeLimit(1)">1</button>
            <button class="time-btn" data-time="5" onclick="setTimeLimit(5)">5</button>
            <button class="time-btn active" data-time="10" onclick="setTimeLimit(10)">10</button>
            <button class="time-btn" data-time="20" onclick="setTimeLimit(20)">20</button>
        </div>
        <button class="menu-btn" onclick="showLeaderboard()">View Best Scores</button>
        <button class="settings-btn" onclick="showSettings()">Settings</button>
    </div>

    <div id="leaderboard-view" class="view-section hidden">
        <h2>Personal Bests</h2>
        <div class="table-wrapper">
            <table class="score-table">
                <thead>
                    <tr>
                        <th>Length</th>
                        <th style="color:#ff5252">1</th>
                        <th style="color:#ffab40">5</th>
                        <th style="color:#448aff">10</th>
                        <th style="color:#69f0ae">20</th>
                    </tr>
                </thead>
                <tbody id="score-body"></tbody>
            </table>
        </div>
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button class="secondary-btn" style="flex:1" onclick="confirmWipe()">Reset</button>
            <button class="menu-btn" style="flex:2; margin-bottom:0;" onclick="showMenu()">Back to Menu</button>
        </div>
    </div>

    <div id="settings-view" class="view-section hidden">
        <h2>Included Digits</h2>
        <div class="controls">
            <div class="digit-grid" id="settings-digit-grid"></div>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="secondary-btn" style="flex:1" onclick="cancelSettings()">Cancel</button>
            <button id="save-settings-btn" class="menu-btn" style="flex:2; margin-bottom:0;" onclick="saveSettings()">Save & Back</button>
        </div>
    </div>

    <div id="app-view" class="view-section hidden">
        <div id="practice-controls" class="controls">
            <label id="app-length-label">Digit Length: 4</label><br>
            <input type="range" id="app-slider" min="1" max="16" value="4" oninput="syncLabels(this.value)" onchange="syncSliders(this.value)">
        </div>
        <div id="timer-bar-container" class="hidden"><div id="timer-bar"></div></div>
        <div id="arabic-display"></div>
        <div id="quiz-ui" class="hidden">
            <div id="feedback"></div>
            <div id="quiz-stats-display">Current Streak: 0</div>
            <input type="text" id="quiz-input" placeholder="Enter numbers..." autocomplete="off">
        </div>
        <div id="western-display" class="hidden"></div>
        <div class="btn-group">
            <button id="menu-btn-app" class="secondary-btn" onclick="showMenu()">Menu</button>
            <button id="back-btn" class="secondary-btn" onclick="goBack()">Back</button>
            <button id="main-action-btn" class="primary-btn" onclick="handleAction()">Action</button>
        </div>
    </div>
</div>

<script>
    const arabicDigits = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
    let history = [], currentMode = '', isRevealed = false, streak = 0, currentLen = 4, selectedTime = 10;
    let timerInterval, timeLeft = 10;
    let allowedDigits = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
    let tempDigits = [];

    const quizInput = document.getElementById('quiz-input');
    const timerBar = document.getElementById('timer-bar');

    function openProfile() { document.getElementById('profile-overlay').classList.add('active'); }
    function closeProfile(e) { document.getElementById('profile-overlay').classList.remove('active'); }

    function openModal(title, text, confirmCallback) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-text').innerText = text;
        const confirmBtn = document.getElementById('modal-confirm-btn');
        confirmBtn.onclick = () => { confirmCallback(); closeModal(); };
        document.getElementById('modal-overlay').classList.add('active');
    }
    function closeModal() { document.getElementById('modal-overlay').classList.remove('active'); }

    function switchView(targetId) {
        document.querySelectorAll('.view-section').forEach(view => {
            view.classList.add('hidden');
        });
        document.getElementById(targetId).classList.remove('hidden');
    }

    function loadSettings() {
        const saved = localStorage.getItem('allowed_digits');
        if (saved) {
            allowedDigits = JSON.parse(saved);
        }
    }

    function setTimeLimit(seconds) {
        selectedTime = seconds;
        document.querySelectorAll('.time-btn').forEach(btn => {
            btn.classList.remove('active');
            if (parseInt(btn.getAttribute('data-time')) === seconds) {
                btn.classList.add('active');
            }
        });
        document.getElementById('quiz-start-btn').innerText = `Quiz Mode (${seconds}s)`;
    }

    function showMenu() {
        clearInterval(timerInterval);
        switchView('main-menu');
        document.getElementById('main-action-btn').disabled = false;
        document.getElementById('menu-btn-app').classList.remove('highlight-menu');
        currentMode = '';
    }

    function showLeaderboard() {
        switchView('leaderboard-view');
        const tbody = document.getElementById('score-body');
        tbody.innerHTML = '';
        const times = [1, 5, 10, 20];
        for(let i=1; i<=16; i++) {
            let row = `<tr><td class="col-len">${i}</td>`;
            times.forEach(t => {
                const score = localStorage.getItem(`best_len${i}_time${t}`) || 0;
                const displayVal = score == 0 ? "-" : score;
                const cssClass = score == 0 ? "empty-score" : `val-${t}s`;
                row += `<td class="${cssClass}">${displayVal}</td>`;
            });
            row += `</tr>`;
            tbody.innerHTML += row;
        }
    }

    function showSettings() { tempDigits = [...allowedDigits]; renderSettingsGrid(); switchView('settings-view'); }

    function renderSettingsGrid() {
        const grid = document.getElementById('settings-digit-grid');
        grid.innerHTML = '';
        for (let i = 0; i <= 9; i++) {
            const isChecked = tempDigits.includes(i);
            const item = document.createElement('div');
            item.className = 'digit-item';
            item.innerHTML = `<span style="font-size:1.2rem">${arabicDigits[i]}</span><input type="checkbox" ${isChecked ? 'checked' : ''} onchange="toggleDigit(${i}, this)">`;
            item.onclick = (e) => { if(e.target.tagName !== 'INPUT') { const cb = item.querySelector('input'); cb.checked = !cb.checked; toggleDigit(i, cb); } };
            grid.appendChild(item);
        }
        validateSettings();
    }

    function toggleDigit(digit, checkbox) {
        if (!checkbox.checked && tempDigits.length <= 2 && tempDigits.includes(digit)) { checkbox.checked = true; return; }
        if (checkbox.checked) { if (!tempDigits.includes(digit)) tempDigits.push(digit); } else { tempDigits = tempDigits.filter(d => d !== digit); }
        tempDigits.sort((a, b) => a - b);
        validateSettings();
    }

    function validateSettings() { document.getElementById('save-settings-btn').disabled = tempDigits.length < 2; }
    function saveSettings() { allowedDigits = [...tempDigits]; localStorage.setItem('allowed_digits', JSON.stringify(allowedDigits)); showMenu(); }
    function cancelSettings() { if (JSON.stringify(allowedDigits) !== JSON.stringify(tempDigits)) { openModal("Discard Changes?", "You have unsaved changes in your digit selection.", showMenu); } else { showMenu(); } }
    function confirmWipe() { openModal("Reset Scores?", "This will permanently delete all your personal bests.", () => { localStorage.clear(); loadSettings(); showLeaderboard(); }); }
    function triggerShake() { quizInput.classList.remove('shake'); void quizInput.offsetWidth; quizInput.classList.add('shake'); }

    function startMode(mode) {
        currentMode = mode; history = []; streak = 0;
        switchView('app-view');
        document.getElementById('main-action-btn').disabled = false;
        document.getElementById('menu-btn-app').classList.remove('highlight-menu');
        const isQuiz = mode === 'quiz';
        document.getElementById('practice-controls').classList.toggle('hidden', isQuiz);
        document.getElementById('quiz-ui').classList.toggle('hidden', !isQuiz);
        document.getElementById('timer-bar-container').classList.toggle('hidden', !isQuiz);
        document.getElementById('western-display').classList.toggle('hidden', isQuiz);
        document.getElementById('back-btn').classList.toggle('hidden', isQuiz);
        if(isQuiz) document.getElementById('quiz-stats-display').innerText = `Current Streak: 0`;
        generate();
    }

    function startTimer() {
        clearInterval(timerInterval);
        timeLeft = selectedTime;
        timerBar.style.width = '100%';
        timerBar.style.backgroundColor = 'var(--success)';
        timerInterval = setInterval(() => {
            timeLeft -= 0.1;
            const percentage = (timeLeft / selectedTime * 100);
            timerBar.style.width = percentage + '%';
            
            // Reinstated color logic
            if (percentage > 50) {
                timerBar.style.backgroundColor = 'var(--success)';
            } else if (percentage > 20) {
                timerBar.style.backgroundColor = 'var(--warning)';
            } else {
                timerBar.style.backgroundColor = 'var(--danger)';
            }

            if (timeLeft <= 0) { clearInterval(timerInterval); handleAction(); }
        }, 100);
    }

    function generate() {
        clearInterval(timerInterval);
        let numStr = "";
        let lastDigit = -1;
        const firstDigitPool = allowedDigits.filter(d => !(d === 0 && currentLen > 1));
        const pool = allowedDigits;
        for(let i=0; i<currentLen; i++) {
            const currentPool = (i === 0) ? firstDigitPool : pool;
            let subPool = currentPool.filter(d => d !== lastDigit);
            if (subPool.length === 0) subPool = currentPool;
            const digit = subPool[Math.floor(Math.random() * subPool.length)];
            numStr += digit.toString();
            lastDigit = digit;
        }
        history.push(numStr);
        if (history.length > 11) history.shift();
        display(numStr);
        if(currentMode === 'quiz') startTimer();
    }

    function display(str) {
        document.getElementById('arabic-display').innerText = str.split('').map(d => arabicDigits[parseInt(d)]).join('');
        document.getElementById('western-display').innerText = str;
        document.getElementById('western-display').style.visibility = 'hidden';
        document.getElementById('feedback').innerText = '';
        quizInput.value = '';
        quizInput.disabled = false;
        document.getElementById('main-action-btn').innerText = currentMode === 'quiz' ? 'Check' : 'Reveal';
        isRevealed = false;
        if(currentMode === 'quiz') setTimeout(() => quizInput.focus(), 10);
    }

    function handleAction() {
        if (document.getElementById('main-action-btn').disabled) return;
        const currentNum = history[history.length - 1];
        if (currentMode === 'generator') {
            if (!isRevealed) {
                document.getElementById('western-display').style.visibility = 'visible';
                document.getElementById('main-action-btn').innerText = 'Continue';
                isRevealed = true;
            } else generate();
        } else {
            if (!isRevealed) {
                const inputVal = quizInput.value.trim();
                if (inputVal.length < currentLen && timeLeft > 0) { triggerShake(); return; }
                clearInterval(timerInterval);
                isRevealed = true;
                quizInput.disabled = true;
                if (inputVal === currentNum) {
                    document.getElementById('feedback').innerText = "Correct!"; 
                    document.getElementById('feedback').className = "correct";
                    streak++;
                    document.getElementById('quiz-stats-display').innerText = `Current Streak: ${streak}`;
                    const key = `best_len${currentLen}_time${selectedTime}`;
                    if (streak > (localStorage.getItem(key) || 0)) localStorage.setItem(key, streak);
                    document.getElementById('main-action-btn').innerText = 'Continue';
                } else {
                    document.getElementById('feedback').innerText = timeLeft <= 0 ? `Time's Up! (${currentNum})` : `Wrong! (${currentNum})`;
                    document.getElementById('feedback').className = "incorrect";
                    streak = 0;
                    document.getElementById('main-action-btn').innerText = 'Game Over';
                    document.getElementById('main-action-btn').disabled = true;
                    document.getElementById('menu-btn-app').classList.add('highlight-menu');
                }
            } else generate();
        }
    }

    function toggleTheme() {
        document.body.classList.toggle('light-mode');
        document.getElementById('theme-toggle').innerText = document.body.classList.contains('light-mode') ? 'â˜€ï¸' : 'ðŸŒ™';
    }

    function syncLabels(val) {
        document.getElementById('menu-length-label').innerText = `Digit Length: ${val}`;
        document.getElementById('app-length-label').innerText = `Digit Length: ${val}`;
    }

    function syncSliders(val) {
        currentLen = parseInt(val);
        document.getElementById('menu-slider').value = val;
        document.getElementById('app-slider').value = val;
        if(currentMode === 'generator') generate();
    }

    function goBack() { if (history.length > 1 && currentMode === 'generator') { history.pop(); display(history[history.length-1]); } }
    document.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleAction(); });
    
    loadSettings();
</script>
</body>
</html>
